{
  "hash": "47514e083fdb7e291059868b47840546",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"akash.yadav\"\n---\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_a654752bd803307fe494bc418448699e'}\n\n```{.r .cell-code}\n# Load the data\ndata <- readRDS(\"../Causal_Data_Science_Data/rand_enc.rds\")\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"rand_enc\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"used_ftr\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"time_spent\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"1\",\"3\":\"30.51346\",\"_rn_\":\"1\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"19.78372\",\"_rn_\":\"2\"},{\"1\":\"1\",\"2\":\"1\",\"3\":\"28.59107\",\"_rn_\":\"3\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"18.63635\",\"_rn_\":\"4\"},{\"1\":\"0\",\"2\":\"0\",\"3\":\"14.55074\",\"_rn_\":\"5\"},{\"1\":\"1\",\"2\":\"0\",\"3\":\"12.41954\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n# Assignment 1\n:::{.callout-important}\nDraw a DAG of how you understand the relationships.\n:::\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_f9bef1dcde3977d7852a7f86cc1f9334'}\n\n```{.r .cell-code}\n# Load the DiagrammeR package\nlibrary(DiagrammeR)\nlibrary(ggplot2)\n\n# Create the DAG\ndag <- create_graph() %>%\n  add_node(label = \"rand_enc\", type = \"factor\", node_aes = node_aes(fillcolor = \"lightblue\",fontcolor = \"black\")) %>%\n  add_node(label = \"used_ftr\", type = \"factor\", node_aes = node_aes(fillcolor = \"lightblue\",fontcolor = \"black\")) %>%\n  add_node(label = \"time_spent\", type = \"outcome\", node_aes = node_aes(fillcolor = \"orange\",fontcolor = \"black\")) %>%\n  add_edge(from = \"rand_enc\", to = \"used_ftr\") %>%\n  add_edge(from = \"used_ftr\", to = \"time_spent\")\n\n# Render the DAG\nrender_graph(dag)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"grViz html-widget html-fill-item\" id=\"htmlwidget-05a9f83ace1396240387\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-05a9f83ace1396240387\">{\"x\":{\"diagram\":\"digraph {\\n\\ngraph [layout = \\\"neato\\\",\\n       outputorder = \\\"edgesfirst\\\",\\n       bgcolor = \\\"white\\\"]\\n\\nnode [fontname = \\\"Helvetica\\\",\\n      fontsize = \\\"10\\\",\\n      shape = \\\"circle\\\",\\n      fixedsize = \\\"true\\\",\\n      width = \\\"0.5\\\",\\n      style = \\\"filled\\\",\\n      fillcolor = \\\"aliceblue\\\",\\n      color = \\\"gray70\\\",\\n      fontcolor = \\\"gray50\\\"]\\n\\nedge [fontname = \\\"Helvetica\\\",\\n     fontsize = \\\"8\\\",\\n     len = \\\"1.5\\\",\\n     color = \\\"gray80\\\",\\n     arrowsize = \\\"0.5\\\"]\\n\\n  \\\"1\\\" [label = \\\"rand_enc\\\", fontcolor = \\\"black\\\", fillcolor = \\\"#ADD8E6\\\"] \\n  \\\"2\\\" [label = \\\"used_ftr\\\", fontcolor = \\\"black\\\", fillcolor = \\\"#ADD8E6\\\"] \\n  \\\"3\\\" [label = \\\"time_spent\\\", fontcolor = \\\"black\\\", fillcolor = \\\"#FFA500\\\"] \\n  \\\"1\\\"->\\\"2\\\" \\n  \\\"2\\\"->\\\"3\\\" \\n}\",\"config\":{\"engine\":\"dot\",\"options\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n# Assignment 2\n:::{.callout-important}\nCompute the naive, biased estimate.\n:::\n\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_aacb5cf81c8bdad923d4e1d8a253aa8f'}\n\n```{.r .cell-code}\n# Compute the naive estimate\nmodel_naive <- lm(time_spent ~ used_ftr, data = data)\nsummary(model_naive)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = data)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n# Assignment 3\n:::{.callout-important}\nFor the assumptions that can be (partly) tested, check whether they are satisfied by either computing correlations or drawing plots. Argue whether instrumental variable estimation is an adequate procedure.\n:::\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_df0418cfb5061e016bb476fc7b80c6ea'}\n\n```{.r .cell-code}\n# Compute correlations\ncorrelation_encouragement_feature <- cor(data$rand_enc, data$used_ftr)\ncorrelation_encouragement_time <- cor(data$rand_enc, data$time_spent)\n\n# Draw plots\nplot(data$rand_enc, data$used_ftr, main=\"Encouragement vs Feature Use\", xlab=\"Encouragement\", ylab=\"Feature Use\")\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(data$rand_enc, data$time_spent, main=\"Encouragement vs Time Spent\", xlab=\"Encouragement\", ylab=\"Time Spent\")\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n:::\n\n\n# Assignment 4\n:::{.callout-important}\nCompute the IV estimate using 2SLS and compare it to the naive estimate. Would you consider the naive estimate biased, and if yes, does it have an upward or downward bias?\n:::\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_18039ed9f5f65dd5c7df0afe69713265'}\n\n```{.r .cell-code}\n# Load the AER package\nlibrary(estimatr)\n\n# Compute the IV estimate using 2SLS\nmodel_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = data)\nsummary(model_iv)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = data)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## The Difference Between Naive and Instrumental Variable Estimates of Feature Usage on App Usage Time\n\nThe first approximation of the effect of feature usage on app usage time is slightly inflated at 10.82. This initial estimate, also known as the naive estimate, fails to account for hidden factors that influence both feature usage and app usage time. These hidden factors, collectively referred to as encouragement, are addressed by the Instrumental Variable (IV) estimate, which produces a more accurate estimate of 9.73. The naive estimate overestimates the effect due to the inclusion of encouragement.\n\n### Key Points\n\n* The naive estimate of the effect of feature usage on app usage time is inflated due to the omission of hidden factors.\n* The IV estimate, based on instrumental variables, is more accurate and provides a lower estimate of the effect.\n* The omitted factor, referred to as encouragement, influences both feature usage and app usage time.\n\n### Conclusion\n\nRecognizing the limitations of the naive estimate and appreciating the value of the IV estimate are essential for conducting rigorous and unbiased causal analyses. By accounting for hidden factors and establishing causal relationships more precisely, we can gain deeper insights into the underlying mechanisms that drive behavior and outcomes.\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\r\n<script src=\"../../site_libs/viz-1.8.2/viz.js\"></script>\r\n<link href=\"../../site_libs/DiagrammeR-styles-0.2/styles.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/grViz-binding-1.0.10/grViz.js\"></script>\r\n<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}