{
  "hash": "7cfb11034162b7580601ef8b3b800ace",
  "result": {
    "markdown": "---\ntitle: \"Randomized Controlled Trials\"\nauthor: \"akash.yadav `<akash.yadav@tuhh.de>`\"\n---\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-1_238205de15b47ebe4c6243fed2e6611b'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\n\nabtest <- readRDS('../Causal_Data_Science_Data/abtest_online.rds')\n```\n:::\n\n\n# Taks 1\n> Check whether the covariates are balanced across the groups. Use a plot to show it.\n\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-2_c0981c3a36731fd7d788d29fbecd2498'}\n\n```{.r .cell-code}\nprev_visit <- \n  ggplot(abtest, \n         aes(x = chatbot, \n             y = previous_visit, \n             color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"Previous Visits\", title = \"Difference in Previous Visits\")\n\npurchase_amt <- \n  ggplot(abtest, \n         aes(x = chatbot, \n             y = purchase_amount, \n             color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"Outcome\", title = \"Difference in outcome\")\n\npurchase <- \n  ggplot(abtest, \n         aes(x = chatbot, \n             y = purchase, \n             color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"Outcome\", title = \"Difference in outcome\")\n\nprev_visit\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\npurchase_amt\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\npurchase\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n:::\n\n\n\n# Task 2\n> Run a regression to find the effect of chatbot on sales\n\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-3_f740ef481223120ffc2533de56f34b6d'}\n\n```{.r .cell-code}\nlm_amt <- lm(purchase_amount ~ chatbot, abtest)\nsummary(lm_amt)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot, data = abtest)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -16.702 -14.478  -9.626  13.922  64.648 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  16.7017     0.8374  19.944  < 2e-16 ***\n#> chatbotTRUE  -7.0756     1.1796  -5.998 2.79e-09 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.65 on 998 degrees of freedom\n#> Multiple R-squared:  0.0348,\tAdjusted R-squared:  0.03383 \n#> F-statistic: 35.98 on 1 and 998 DF,  p-value: 2.787e-09\n```\n:::\n:::\n\n\nThere appears to be a negative correlation between chatbot and sales.\n\n# Task 3\n> Find subgroup-specific effects by including an interaction. Compute a CATE for one exemplary group. A subgroup could be for example mobile users.\n\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-4_fa62e08a9c14fd569319c9c8f131217b'}\n\n```{.r .cell-code}\nlm_cate <- lm(purchase_amount ~ chatbot * previous_visit + chatbot * mobile_device, abtest)\nsummary(lm_cate)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot * previous_visit + chatbot * \n#>     mobile_device, data = abtest)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -22.057 -15.928  -7.419  12.804  65.333 \n#> \n#> Coefficients:\n#>                               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)                    17.2052     1.2982  13.253  < 2e-16 ***\n#> chatbotTRUE                   -11.1064     1.8434  -6.025 2.38e-09 ***\n#> previous_visit                 -0.1030     0.3749  -0.275 0.783562    \n#> mobile_deviceTRUE              -0.8791     1.7823  -0.493 0.621943    \n#> chatbotTRUE:previous_visit      2.0978     0.5781   3.629 0.000299 ***\n#> chatbotTRUE:mobile_deviceTRUE   0.2044     2.5148   0.081 0.935229    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.49 on 994 degrees of freedom\n#> Multiple R-squared:  0.05495,\tAdjusted R-squared:  0.0502 \n#> F-statistic: 11.56 on 5 and 994 DF,  p-value: 7.177e-11\n```\n:::\n:::\n\n\n# Task 4\n> Itâ€™s not only of interest how much customers buy but also if the buy at all. Then, the dependent variable is binary (either 0 or 1) instead of continuous and the model of choice is the logistic regression. Use the outcome variable purchase and run a logistic regression. The coefficients are not as easily interpretable as before. Look it up and interpret the coefficient for chatbot.\n\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-5_10e07d6d729ced5fed19c160d2681b58'}\n\n```{.r .cell-code}\nlibrary(stats)\nlm_boolean <- glm(purchase ~ chatbot * previous_visit + chatbot * mobile_device, family = binomial(link = 'logit'), data = abtest)\nsummary(lm_boolean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> glm(formula = purchase ~ chatbot * previous_visit + chatbot * \n#>     mobile_device, family = binomial(link = \"logit\"), data = abtest)\n#> \n#> Coefficients:\n#>                               Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept)                    0.03872    0.14047   0.276    0.783    \n#> chatbotTRUE                   -1.65686    0.22511  -7.360 1.84e-13 ***\n#> previous_visit                -0.01769    0.04061  -0.436    0.663    \n#> mobile_deviceTRUE             -0.05177    0.19284  -0.268    0.788    \n#> chatbotTRUE:previous_visit     0.32646    0.06912   4.723 2.32e-06 ***\n#> chatbotTRUE:mobile_deviceTRUE -0.01616    0.29818  -0.054    0.957    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 1329.1  on 999  degrees of freedom\n#> Residual deviance: 1238.6  on 994  degrees of freedom\n#> AIC: 1250.6\n#> \n#> Number of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\ncoef_df <- as.data.frame(coef(summary(lm_boolean)))\n\n# Extracting coefficients and confidence intervals\ncoef_df <- coef_df %>%\n  mutate(term = rownames(coef_df),\n         Estimate = Estimate,\n         CI_low = Estimate - 1.96 * `Std. Error`,\n         CI_high = Estimate + 1.96 * `Std. Error`)\n\n# Plotting coefficients with confidence intervals using ggplot2\nlibrary(ggplot2)\n\nggplot(coef_df, aes(x = Estimate, y = term)) +\n  geom_errorbarh(aes(xmin = CI_low, xmax = CI_high), height = 0.2, color = \"black\") +\n  labs(title = \"Logistic Regression Coefficients with 95% Confidence Intervals\",\n       x = \"Estimate\",\n       y = \"Coefficient\") +\n  theme_minimal() +\n  theme(axis.text.y = element_text(size = 10),\n        axis.text.x = element_text(size = 10))\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}